<div class="m-content">
	<div class="row">
		<div class="col-lg-8">
			<div class="m-subheader">
				<div class="d-flex align-items-center">
					<div class="mr-auto">
						<h3 class="m-subheader__title">
							Kubernetes Cluster
						</h3>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-2">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">API Server</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px; text-align: center;">
								<div class="m-widget14__chart">
									<div class="m-widget14__stat">
										<a href="#" class="btn-link m--font-metal">
											<strong id="apiServerStatus">True</strong>
										</a>
									</div>	
								</div>	
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-2">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">Controller</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px; text-align: center;">
								<div class="m-widget14__chart">
									<div class="m-widget14__stat">
										<a href="#" class="btn-link m--font-metal">
											<strong id="apiServerStatus">True</strong>
										</a>
									</div>	
								</div>	
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-2">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">ETCD</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px; text-align: center;">
								<div class="m-widget14__chart">
									<div class="m-widget14__stat">
										<a href="#" class="btn-link m--font-metal">
											<strong id="apiServerStatus">True</strong>
										</a>
									</div>	
								</div>	
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-2">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">Scheduler</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px; text-align: center;">
								<div class="m-widget14__chart">
									<div class="m-widget14__stat">
										<a href="#" class="btn-link m--font-metal">
											<strong id="apiServerStatus">True</strong>
										</a>
									</div>	
								</div>	
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-2">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">Nodes</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px; text-align: center;">
								<div class="m-widget14__chart">
									<div class="m-widget14__stat">
										<a href="#" class="btn-link m--font-metal">
											<strong id="nodeTotal">0</strong>
										</a>
									</div>	
								</div>	
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-2">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">Event Error</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px; text-align: center;">
								<div class="m-widget14__chart">
									<div class="m-widget14__stat">
										<a href="#" class="btn-link m--font-metal">
											<strong id="errorTotal">0</strong>
										</a>
									</div>	
								</div>	
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="m-subheader">
				<div class="d-flex align-items-center">
					<div class="mr-auto">
						<h3 class="m-subheader__title">
							Kubernetes Workloads
						</h3>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-2">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">Daemon Sets</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px; text-align: center;">
								<div class="m-widget14__chart">
									<div class="m-widget14__stat">
										<a href="#" class="btn-link m--font-metal">
											<strong id="daemonSetsTotal">0</strong>
										</a>
									</div>	
								</div>	
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-2">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">Deployments</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px; text-align: center;">
								<div class="m-widget14__chart">
									<div class="m-widget14__stat">
										<a href="#" class="btn-link m--font-metal">
											<strong id="deploymentsTotal">0</strong>
										</a>
									</div>	
								</div>	
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-2">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">Pods</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px; text-align: center;">
								<div class="m-widget14__chart">
									<div class="m-widget14__stat">
										<a href="#" class="btn-link m--font-metal">
											<strong id="podTotal">0</strong>
										</a>
									</div>	
								</div>	
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-2">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">Replica Sets</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px; text-align: center;">
								<div class="m-widget14__chart">
									<div class="m-widget14__stat">
										<a href="#" class="btn-link m--font-metal">
											<strong id="replicaSetsTotal">0</strong>
										</a>
									</div>	
								</div>	
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-2">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">Stateful Sets</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px; text-align: center;">
								<div class="m-widget14__chart">
									<div class="m-widget14__stat">
										<a href="#" class="btn-link m--font-metal">
											<strong id="statefulSetsTotal">0</strong>
										</a>
									</div>	
								</div>	
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-2">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text"></div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px;">
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-4">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">Cluster Cpu Utilization</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px;">
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-4">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">Cluster Memory Utilization</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px;">
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-4">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">Cluster Pod Utilization</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px;">
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-lg-4">
			<div class="m-subheader">
				<div class="d-flex align-items-center">
					<div class="mr-auto">
						<h3 class="m-subheader__title">
							Infrastructures
						</h3>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-6">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">Host</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px; text-align: center;">
								<div class="m-widget14__chart">
									<div class="m-widget14__stat">
										<a href="#" class="btn-link m--font-metal">
											<strong id="hostTotal">0</strong>
										</a>
									</div>	
								</div>	
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-6">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">Docker Container</div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 80px; text-align: center;">
								<div class="m-widget14__chart">
									<div class="m-widget14__stat">
										<a href="#" class="btn-link m--font-metal">
											<strong id="containerTotal">0</strong>
										</a>
									</div>	
								</div>	
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="m-subheader">
				<div class="d-flex align-items-center">
					<div class="mr-auto">
						<h3 class="m-subheader__title">
						&nbsp
						</h3>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
						<div class="m-portlet__head">
							<div class="m-portlet__head-caption">
								<div class="m-portlet__head-title">
									<div class="m-portlet__head-text">Infrastructure Map </div>
								</div>
							</div>
							<div class="m-portlet__head-tools"></div>
						</div>
						<div class="m-portlet__body">
							<div class="m-widget14" style="height: 254px;" id = "infrastructureMapChartArea">
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-lg-4">
			<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
				<div class="m-portlet__head">
					<div class="m-portlet__head-caption">
						<div class="m-portlet__head-title">
							<div class="m-portlet__head-text">Agent List</div>
						</div>
					</div>
					<div class="m-portlet__head-tools"></div>
				</div>
				<div class="m-portlet__body">
					<div class="m-widget4" style="height: 200px; overflow-x: hidden;" id="agentListArea" >
					</div>
				</div>
			</div>
		</div>
		<div class="col-lg-4">
			<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
				<div class="m-portlet__head">
					<div class="m-portlet__head-caption">
						<div class="m-portlet__head-title">
							<div class="m-portlet__head-text">Pods Top Cpu</div>
						</div>
					</div>
					<div class="m-portlet__head-tools"></div>
				</div>
				<div class="m-portlet__body">
					<div class="m-widget14" style="height: 200px;" id="topPodCpuChart">
					</div>
				</div>
			</div>
		</div>
		<div class="col-lg-4">
			<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
				<div class="m-portlet__head">
					<div class="m-portlet__head-caption">
						<div class="m-portlet__head-title">
							<div class="m-portlet__head-text">Pods Top Memory</div>
						</div>
					</div>
					<div class="m-portlet__head-tools"></div>
				</div>
				<div class="m-portlet__body">
					<div class="m-widget14" style="height: 200px;" id="topPodMemChart">
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-lg-4">
			<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
				<div class="m-portlet__head">
					<div class="m-portlet__head-caption">
						<div class="m-portlet__head-title">
							<div class="m-portlet__head-text">Node Top Cpu</div>
						</div>
					</div>
					<div class="m-portlet__head-tools"></div>
				</div>
				<div class="m-portlet__body">
					<div class="m-widget14" style="height: 200px;" id="topCpuChart">
					</div>
				</div>
			</div>
		</div>
		<div class="col-lg-4">
			<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
				<div class="m-portlet__head">
					<div class="m-portlet__head-caption">
						<div class="m-portlet__head-title">
							<div class="m-portlet__head-text">Node Top Memory</div>
						</div>
					</div>
					<div class="m-portlet__head-tools"></div>
				</div>
				<div class="m-portlet__body">
					<div class="m-widget14" style="height: 200px;" id="topMemChart">
					</div>
				</div>
			</div>
		</div>
		<div class="col-lg-4">
			<div class="m-portlet m-portlet--head-sm m-portlet--full-height ">
				<div class="m-portlet__head">
					<div class="m-portlet__head-caption">
						<div class="m-portlet__head-title">
							<div class="m-portlet__head-text">Node Top Disk</div>
						</div>
					</div>
					<div class="m-portlet__head-tools"></div>
				</div>
				<div class="m-portlet__body">
					<div class="m-widget14" style="height: 200px;" id="topDiskChart">
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<link href="/resources/css/billboard/billboard.min.css" rel="stylesheet" >
<script src="/resources/js/module/common/client.js" type="text/javascript"></script>
<script src="/resources/js/module/common/colors.js" type="text/javascript"></script>
<script src="/resources/js/module/list/statusList.js" type="text/javascript"></script>
<script src="/resources/js/module/chart/donut.js" type="text/javascript"></script>
<script src="/resources/js/module/chart/tilemap.js" type="text/javascript"></script>
<script src="/resources/js/lib/billboard/d3.min.js" type="text/javascript"></script>
<script src="/resources/js/lib/billboard/billboard.min.js" type="text/javascript"></script>
<style type="text/css">
.histogramLine60 line {
    stroke: #ffb822;
    stroke-width: 2;
    stroke-dasharray: 2,2;
}
.histogramLine80 line {
    stroke: #f4516c;
    stroke-width: 2;
    stroke-dasharray: 2,2;
}
</style>
<script type="text/javascript">
function drawNode(data) {
	$("#nodeTotal").text(data.items.length);
}

function drawPod(data) {
	$("#podTotal").text(data.items.length);
	var formatHistogramData = [];
	data.items.forEach(function(item){
		formatHistogramData.push({
			name : item.metadata.name,
			cpu : item.resource.used_percent.cpu,
			mem : item.resource.used_percent.memory
		});
	})
	drawHistogramChart("topPodCpuChart", formatHistogramData, "cpu");
	drawHistogramChart("topPodMemChart", formatHistogramData, "mem");
}
function drawDaemonSet(data) {
	$("#daemonSetsTotal").text(data.items.length);
}
function drawDeployments(data) {
	$("#deploymentsTotal").text(data.items.length);
}
function drawReplicaSets(data) {
	$("#replicaSetsTotal").text(data.items.length);
}
function drawStatefulSets(data) {
	$("#statefulSetsTotal").text(data.items.length);
}

function drawHost (data) {
	$("#hostTotal").text(data.length);
	// container count..
	drawInfrastructureMap(data);
	drawTopChart(data);
}
function drawInfrastructureMap (data) {
	var tilemapData = [];
	data.forEach(function (item){
		tilemapData.push({'hc-a2' : item.host_ip, name : item.host_name, value: item.cpu.cpu_per });
	})
	new Tilemap().area("infrastructureMapChartArea").data(tilemapData).draw();
}

function drawAgents(data) {
	var fields = ['host_name','host_ip', 'status'];
	new StatusList().area("agentListArea").fields(fields).data(data).draw();
}
function drawTopChart(data) {
	var formatHistogramData = formatHistogramChartData(data);
	drawHistogramChart("topCpuChart", formatHistogramData, "cpu");
	drawHistogramChart("topMemChart", formatHistogramData, "mem");
	drawHistogramChart("topDiskChart", formatHistogramData, "disk");
}
function drawHistogramChart (chartArea, chartData, key){
	var categories = [];
	var key_normal = key+"_normal";
	var key_warning = key+"_warning";
	var key_danger = key+"_danger";
	var columnNormal = [key_normal];
	var columnWarning = [key_warning];
	var columnDanger = [key_danger];
	chartData.sort(function(a, b) {return b[key] - a[key];}).forEach(function(item, idx){
		if (idx < 5) {
			if (item[key] <60) {
				columnNormal.push(item[key]);
				columnWarning.push(0);
				columnDanger.push(0);
			} else if(item[key] < 80){
				columnNormal.push(0);
				columnWarning.push(item[key]);
				columnDanger.push(0);
			} else if (item[key] >= 80){
				columnNormal.push(0);
				columnWarning.push(0);
				columnDanger.push(item[key]);
			}
				if (key == "disk")
					categories.push(item.name + "\n[" + item.mountName + "]");
				else
					categories.push(item.name);
		}
	})
	bb.generate({
		axis: {
			rotated: true,
			x: {
				show : false
			},
			y : {
				max : 90,
				min : 10
			}
		},
		data: {
			columns: [columnNormal,columnWarning,columnDanger],
			types: {
				[key_normal]: "bar",
				[key_warning]: "bar",
				[key_danger]: "bar"
			},
			groups: [
				[
					key_normal,key_warning,key_danger
				]
			],
			labels : {
				format : function (value, xx, idx) {
					if (value != 0)
						return categories[idx];
					else 
						return null;
				}
			},
			onclick : function(d,x,w,r){
			}
		},
		grid : {
			y : {
				show : false,
				lines : [
					{value : 60, class : "histogramLine60"},
					{value : 80, class : "histogramLine80"}
				]
			}
		},
		bar: {
			radius: {
				ratio: 0.5
			}
		},
		color: {
			pattern: [
				"#00c5dc","#ffb822","#f4516c"
			]
		},
		legend : {
			show : false
		},
		tooltip: {
			grouped: false
		},
		bindto: "#" + chartArea
	});
	d3.selectAll("g.bb-chart-texts text").style("fill", "black").attr("x", "10");
}
function formatHistogramChartData (data) {
	var result = [];
	data.forEach(function(item){
		var cpuPer = 0;
		var memPer = 0;
		var diskPer = 0;
		var name = item.host_name;
		var mountName;
		cpuPer = item.cpu.cpu_per;
		memPer = item.mem.used_per;
		
		item.disks.forEach(function(disk, idx){
			if (idx == 0) {
				diskPer = disk.used_per;
				mountName = disk.mountName;
			}
			else if (diskPer < disk.used_per) {
				diskPer = disk.used_per;
				mountName = disk.mountName;
			}
		});
		diskPer = parseFloat(diskPer.toFixed(2));
		var m = {
			ip : item.host_ip, 
			name : name,
			mountName : mountName,
			cpu : cpuPer,
			mem : memPer,
			disk : diskPer
		}
		//if(item.status == "ACTIVE")
		result.push(m);
	});
	return result;
}

new Client().url("/api/v1/kubernetes/node/snapshot").callback(drawNode).get();

new Client().url("/api/v1/kubernetes/pod/snapshot").callback(drawPod).get();
new Client().url("/api/v1/kubernetes/daemonset/snapshot").callback(drawDaemonSet).get();
new Client().url("/api/v1/kubernetes/deployment/snapshot").callback(drawDeployments).get();
new Client().url("/api/v1/kubernetes/replicaset/snapshot").callback(drawReplicaSets).get();
new Client().url("/api/v1/kubernetes/statefulset/snapshot").callback(drawStatefulSets).get();

new Client().url("/api/v1/host/snapshot").callback(drawHost).get();


new Client().url("/api/v1/kubernetes/component/status/snapshot").callback(function(data){
	//console.log(data);
}).get();

new Client().url("/api/v1/host/agent/status").callback(drawAgents).get();

</script>